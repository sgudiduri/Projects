---
title: "MGT6203_Project_Data_Analysis"
author: "VTHENMOZHI3"
date: '2022-07-06'
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Home Price Prediction in Ames, Iowa - Team 84

We expect to build a model that has a minimum RMSE < 6000 and 𝑹𝟐 '> 80% when predicting against the test dataset.  Iterative methods i.e., using feature engineering, dimension reduction for model building, and model selection will determine the conclusion of our analysis. We hope to find a reduced subset of attributes that can predict the sales price. 

### Load necessary libraries


```{r}
library(fastDummies)# Creating dummy variables
library(dplyr)      # Data manipulation and joining
library(glmnet)     # Regression
library(ggplot2)    # Ploting
library(caret)      # Modeling
library(xgboost)    # Building XGBoost model
library(e1071)      # Skewness
library(cowplot)    # Combining multiple plots
library(MASS)
library(randomForest)
```

### Read the Train and Test csvs files. We will not using the test.csv for training our model. These files were downloaded from Kaggle using kaggleAPI (Python). Consumer price index was downloaded from US Bureau of Labor Statistics
https://data.bls.gov/pdq/SurveyOutputServlet 

```{r}
ames_train <- read.csv("house-price/train.csv", fileEncoding="UTF-8-BOM")
ames_test <- read.csv("house-price/test.csv", fileEncoding="UTF-8-BOM")
cpi <- read.csv("house-price/cpi.csv", fileEncoding="UTF-8-BOM")

```

### Join the consumer price index data with the training data using YrSold - Factor in for the inflation 

```{r}

# Join train and test with cpi values with year as the index
names(cpi)[names(cpi)=='Year'] <- 'YrSold'

ames_train <- merge(x=ames_train, y=cpi, by="YrSold")
#summary(ames_train)

#ames_test <- merge(x=ames_test, y=cpi, by="YrSold")
#summary(ames_test)

```

### Clean-up data - remove Id, Year sold and Month Sold columns from the training dataset

```{r}

# Remove Id and set NA to zeros
amesTrain <- subset(ames_train, select=-c(Id))
amesTrain[is.na(amesTrain)] = 0

# Remove YrSold and MoSold as we have included CPI
amesTrain <- subset(ames_train, select=-c(YrSold, MoSold))

```

```{r}

# summary(amesTrain)
```


### Scale all the continuous numeric columns that can be scaled

```{r}
# 

numeric_cols <- c("LotFrontage", "LotArea", "MasVnrArea","BsmtFinSF1", "BsmtFinSF2", "BsmtUnfSF", "TotalBsmtSF", "X1stFlrSF", "X2ndFlrSF", "LowQualFinSF", "GrLivArea", "GarageArea", "WoodDeckSF", "OpenPorchSF", "EnclosedPorch", "X3SsnPorch", "ScreenPorch", "PoolArea", "MiscVal", "CPI")


```


```{r}
# Scale numeric columns using scale function

df1 <- amesTrain[numeric_cols]

scaleddf <- data.frame(scale(df1, center = TRUE, scale = TRUE))

#head(scaleddf)
```

### Remove the original continuous numeric columns from the dataframe and add the scaled columns

```{r}
# Remove the original continuous numeric columns from the dataframe
amesTrain <- subset(amesTrain, select=-c(LotFrontage, LotArea, MasVnrArea, BsmtFinSF1, BsmtFinSF2, BsmtUnfSF, TotalBsmtSF, X1stFlrSF, X2ndFlrSF, LowQualFinSF, GrLivArea, GarageArea, WoodDeckSF, OpenPorchSF, EnclosedPorch, X3SsnPorch, ScreenPorch, PoolArea, MiscVal, CPI))

# Add the scaled columns to the dataframe
amesTrain[numeric_cols] <- scaleddf[numeric_cols]

# Default Garage built to YearBuilt if data is not available
amesTrain <- within(amesTrain, GarageYrBlt[is.na(GarageYrBlt)] <- YearBuilt)

# Default all other NAs to 0s
amesTrain <- amesTrain %>% mutate_all(funs(ifelse(is.na(.), 0, .)))

```

### Convert some of the numeric like columns to factors

```{r}
# Convert some of the numeric like columns to factors

amesTrain$MSSubClass <- as.factor(amesTrain$MSSubClass)
amesTrain$OverallQual <- as.factor(amesTrain$OverallQual)
amesTrain$OverallCond <- as.factor(amesTrain$OverallCond)
amesTrain$YearBuilt <- as.factor(amesTrain$YearBuilt)
amesTrain$YearRemodAdd <- as.factor(amesTrain$YearRemodAdd)
amesTrain$GarageYrBlt <- as.factor(amesTrain$GarageYrBlt)

```



```{r}
#summary(amesTrain)
```

### Data Preparation for Model Training


```{r}
# Split the data to Train and Test
set.seed(123)

sample_size <- floor(0.75 * nrow(amesTrain))

train_index <- sample(seq_len(nrow(amesTrain)), size=sample_size)

train <- amesTrain[train_index, ]
test <- amesTrain[-train_index, ]

```

### Simple Regression with all variables included; we can use this model to build Stepwise Regression to identify the most significant variables

```{r}

lm_simple <- lm(SalePrice~., data=train)
print(paste("Simple Linear Regression: R-Squared and Adjusted R-Squared - ", summary(lm_simple)$r.squared, summary(lm_simple)$adj.r.squared))

```

### Step 1: Use Stepwise Regression using the above simple model to identify a preliminerary set of significant variables that can predict the SalePrice

```{r}

step_model <- stepAIC(lm_simple, direction="both", trace=FALSE)
#summary(step_model)
step_model$coefficients
```


```{r}
# Based on the Step-wise regression model, the number of coefficients can be trimmed to 44

signi_coe <- c("MSZoning", "LandContour", "Utilities", "LotConfig", "LandSlope", "Neighborhood", "Condition1", "Condition2", "BldgType", "HouseStyle", "OverallQual", "OverallCond", "RoofMatl", "Exterior1st", "ExterCond", "Foundation", "BsmtQual", "BsmtExposure", "BsmtFinType1", "FullBath", "HalfBath", "BedroomAbvGr", "KitchenAbvGr", "KitchenQual", "TotRmsAbvGrd", "Functional", "Fireplaces", "FireplaceQu", "GarageType", "PoolQC", "Fence", "SaleCondition", "LotArea", "MasVnrArea", "BsmtFinSF1", "BsmtFinSF2", "BsmtUnfSF", "X1stFlrSF", "X2ndFlrSF", "GarageArea", "WoodDeckSF", "X3SsnPorch", "ScreenPorch", "PoolArea", "SalePrice")

```

```{r}
summary(train)
```


```{r}
print(paste("Stepwise Linear Regression: R-Squared and Adjusted R-Squared - ", summary(step_model)$r.squared, summary(step_model)$adj.r.squared))
```
```{r}

train_1 <- train[signi_coe]

train_1 <- train[signi_coe]
test_1 <- test[signi_coe]

rf_model <- randomForest(SalePrice~., data=train_1, ntree=1000, importance=TRUE, type="regression" )
```


```{r}
summary(rf_model)
```


```{r}
ImpData <- as.data.frame(importance(rf_model))
ImpData$Var.Names <- row.names(ImpData)
ImpData$Var.Names
```
